"$schema" = "https://raw.githubusercontent.com/JanDeDobbeleer/oh-my-posh/main/themes/schema.json"
version = 4
final_space = true
async = true

# --- Catppuccin Mocha (red from Tokyo Night) ---
[palette]
rosewater = '#f5e0dc'
flamingo = '#f2cdcd'
pink = '#f5c2e7'
mauve = '#cba6f7'
red = '#f7768e'
maroon = '#eba0ac'
peach = '#fab387'
yellow = '#f9e2af'
green = '#a6e3a1'
teal = '#94e2d5'
sky = '#89dceb'
sapphire = '#74c7ec'
blue = '#89b4fa'
lavender = '#b4befe'
text = '#cdd6f4'
subtext1 = '#bac2de'
subtext0 = '#a6adc8'
overlay2 = '#9399b2'
overlay1 = '#7f849c'
overlay0 = '#6c7086'
surface2 = '#585b70'
surface1 = '#45475a'
surface0 = '#313244'
base = '#1e1e2e'
mantle = '#181825'
crust = '#11111b'

[upgrade]
auto = true
notice = true

# Main prompt
[[blocks]]
type = 'prompt'
alignment = 'left'
newline = true

# SSH indicator (only shows in SSH sessions)
[[blocks.segments]]
type = 'session'
style = 'plain'
foreground = 'p:red'
template = "{{ if .SSHSession }}\uF489 {{ .UserName }}@{{ .HostName }} {{ end }}"

# Directory (full path, no truncation)
[[blocks.segments]]
type = 'path'
style = 'plain'
foreground = 'p:maroon'
template = "{{ .Path }}{{ if not .Writable }} \U000F033E{{ end }} "
options = { style = 'full', home_icon = '~' }

# Git (worktree-aware: bare root shows worktree icon only, worktree checkouts show full git info with worktree prefix)
[[blocks.segments]]
type = 'git'
style = 'plain'
foreground = 'p:lavender'
timeout = 200
template = "{{ if .IsBare }}on \U000F0645 worktrees {{ else }}on {{ if .IsWorkTree }}\U000F0645 {{ else }}\uE725 {{ end }}{{ .HEAD }}{{ if or .Working.Changed .Staging.Changed }} [{{ if .Staging.Changed }}+{{ end }}{{ if .Working.Changed }}!{{ end }}{{ if gt .Working.Untracked 0 }}?{{ end }}{{ if gt .Working.Deleted 0 }}\u2718{{ end }}]{{ end }}{{ if gt .StashCount 0 }} ${{ end }} {{ end }}"
options = { fetch_status = true, fetch_bare_info = true, branch_icon = "", commit_icon = "\uF417 ", tag_icon = "\uF412 " }

# Kubernetes context (only in k8s/k3s project dirs)
[[blocks.segments]]
type = 'kubectl'
style = 'plain'
foreground = 'p:blue'
timeout = 200
template = "<p:overlay0>\u2022</> \U000F10FE {{ .Context }}{{ if .Namespace }} ({{ .Namespace }}){{ end }} "
include_folders = ['.*k[38]s.*']

# Docker context — context-based (non-orbstack, outside docker paths)
[[blocks.segments]]
type = 'docker'
style = 'plain'
foreground = 'p:sky'
timeout = 200
template = "{{ if ne .Context \"orbstack\" }}<p:overlay0>\u2022</> \uF308  {{ .Context }} {{ end }}"
exclude_folders = ['.*docker.*']

# Docker context — file-based (compose/Dockerfile in cwd, outside docker paths)
[[blocks.segments]]
type = 'docker'
style = 'plain'
foreground = 'p:sky'
timeout = 200
template = "{{ if or (eq .Context \"orbstack\") (eq .Context \"default\") }}<p:overlay0>\u2022</> \uF308  {{ .Context }} {{ end }}"
exclude_folders = ['.*docker.*']
options = { display_mode = 'files', fetch_context = true }

# Docker context — path-based (dir path contains "docker", any context)
[[blocks.segments]]
type = 'docker'
style = 'plain'
foreground = 'p:sky'
timeout = 200
template = "<p:overlay0>\u2022</> \uF308  {{ .Context }} "
include_folders = ['.*docker.*']

# Node.js
[[blocks.segments]]
type = 'node'
style = 'plain'
foreground = 'p:green'
timeout = 200
template = "<p:overlay0>\u2022</> \uE718 {{ .Full }} "
options.display_mode = 'context'
options.cache_duration = '5m'

[blocks.segments.cache]
duration = "5m"
strategy = "folder"

# pnpm (lockfile-gated via glob)
[[blocks.segments]]
type = 'pnpm'
style = 'plain'
foreground = 'p:peach'
timeout = 500
template = "{{ if glob \"pnpm-lock.yaml\" }}<p:overlay0>\u2022</> \ue865 {{ .Full }} {{ end }}"
options.cache_duration = '5m'

[blocks.segments.cache]
duration = "5m"
strategy = "folder"

# npm (lockfile-gated via glob)
[[blocks.segments]]
type = 'npm'
style = 'plain'
foreground = 'p:red'
timeout = 500
template = "{{ if glob \"package-lock.json\" }}<p:overlay0>\u2022</> \uE71E {{ .Full }} {{ end }}"
options.cache_duration = '5m'

[blocks.segments.cache]
duration = "5m"
strategy = "folder"

# Go
[[blocks.segments]]
type = 'go'
style = 'plain'
foreground = 'p:teal'
timeout = 200
template = "<p:overlay0>\u2022</> \uE627 {{ .Full }} "

# Python
[[blocks.segments]]
type = 'python'
style = 'plain'
foreground = 'p:yellow'
timeout = 200
template = "<p:overlay0>\u2022</> \uE235 {{ .Full }} "

# Zig
[[blocks.segments]]
type = 'zig'
style = 'plain'
foreground = 'p:flamingo'
timeout = 200
template = "<p:overlay0>\u2022</> \ue6a9 {{ .Full }} "
options.display_mode = 'context'

# Execution time (only shows for commands >2s)
[[blocks.segments]]
type = 'executiontime'
style = 'plain'
foreground = 'p:peach'
template = "<p:overlay0>\u2022</> \u23F1 {{ .FormattedMs }} "
options = { threshold = 2000, style = 'austin' }

# Battery warning (right-aligned, only when discharging <25%)
[[blocks]]
type = 'prompt'
alignment = 'right'

[[blocks.segments]]
type = 'battery'
style = 'plain'
foreground = 'p:green'
foreground_templates = [
  "{{ if lt .Percentage 20.0 }}p:red{{ end }}",
  "{{ if and (ge .Percentage 20.0) (lt .Percentage 40.0) }}p:maroon{{ end }}",
  "{{ if and (ge .Percentage 40.0) (lt .Percentage 60.0) }}p:yellow{{ end }}",
]
template = "{{ if eq .State.String \"Discharging\" }}{{ if lt .Percentage 10.0 }}\U000F007A{{ else if lt .Percentage 20.0 }}\U000F007B{{ else if lt .Percentage 30.0 }}\U000F007C{{ else if lt .Percentage 40.0 }}\U000F007D{{ else if lt .Percentage 50.0 }}\U000F007E{{ else if lt .Percentage 60.0 }}\U000F007F{{ else if lt .Percentage 70.0 }}\U000F0080{{ else if lt .Percentage 80.0 }}\U000F0081{{ else }}\U000F0082{{ end }}  {{ round .Percentage 0 }}%{{ if lt .Percentage 20.0 }}!{{ end }} {{ end }}{{ if and (eq .State.String \"Charging\") (lt .Percentage 80.0) }}{{ if lt .Percentage 40.0 }}\U000F089C{{ else }}\U000F008A{{ end }}  {{ round .Percentage 0 }}% {{ end }}"

# # CPU load (>60%, red >80%, derived from Load5 / 10 cores)
# [[blocks.segments]]
# type = 'sysinfo'
# style = 'plain'
# foreground = 'p:peach'
# foreground_templates = ["{{ if gt (mulf (divf .Load5 10.0) 100.0) 80.0 }}p:red{{ end }}"]
# template = "{{ if gt (mulf (divf .Load5 10.0) 100.0) 60.0 }}\U000F035B  {{ round (mulf (divf .Load5 10.0) 100.0) 0 }}% <p:overlay0>\u2022</> {{ end }}"
#
# # Memory (>60%, red >80%)
# [[blocks.segments]]
# type = 'sysinfo'
# style = 'plain'
# foreground = 'p:yellow'
# foreground_templates = ["{{ if gt .PhysicalPercentUsed 80.0 }}p:red{{ end }}"]
# template = "{{ if gt .PhysicalPercentUsed 60.0 }}\uefc5  {{ round .PhysicalPercentUsed 0 }}%{{ end }}"

# Prompt character (on new line, red on error)
[[blocks]]
type = 'prompt'
alignment = 'left'
newline = true

[[blocks.segments]]
type = 'status'
style = 'plain'
foreground = 'p:green'
foreground_templates = ["{{ if gt .Code 0 }}p:red{{ end }}"]
template = "\u276F"
options.always_enabled = true
